import{d as e,p as a,ad as t,U as s,ae as l,g as r,A as n,z as i,K as o,C as d,D as u,M as c,af as m,ag as v,B as g,q as f,s as $,o as p,f as h,w as b,u as y,h as w,y as x,i as S,v as E,x as F,t as V,e as _,Z as A,ah as R,E as T,G as P,l as I,L as j,ai as z,aj as M,ak as q,al as O,am as k,an as C,T as B,a3 as W}from"./index-158834fb.js";import{b as Z,_ as D}from"./index.a84991b2.js";import{b as H,g as N,a as G,c as K}from"./dom.607148e9.js";import{f as L,a as U,b as J,c as Q,d as X}from"./common.26852cb0.js";const Y=D(e({options:{virtualHost:!0,styleIsolation:"shared"},__name:"form-item",props:L,setup(e,{expose:z}){const M=e,q=Z("form-item"),O=U();if(!O)throw new Error("FormItem must be included in Form.");let k=!1;const C=a({get(){const e=O.model;if(e&&M.name)return t(e,s(M.name))},set(e){const a=O.model;a&&M.name&&l(a,s(M.name),e)}});let B;const W=r("");n((()=>M.error),(()=>{W.value=M.error||"",L.value=M.error?"error":""}));const D=a((()=>(M.showError??O.showError)&&W.value)),L=r(""),Q=a((()=>{const e=M.validateTrigger??O.validateTrigger;return e?s(e):void 0})),X=a((()=>{const e=[];M.rules&&e.push(...s(M.rules));const a=O.rules;if(a&&M.name){const l=t(a,s(M.name));l&&e.push(...s(l))}const l=M.required;if(void 0!==l){const a=e.map(((e,a)=>[e,a])).filter((([e])=>Object.keys(e).includes("required")));if(a.length>0)for(const[t,s]of a)t.required!==l&&(e[s]={...t,required:l});else e.push({required:l})}const r=Q.value;if(r&&r.length>0)for(let t=0,s=e.length;t<s;t++){const a=e[t];a.trigger||(e[t]={...a,trigger:[...r]})}return e})),Y=a((()=>X.value.some((e=>e.required)))),ee=a((()=>i(M.showStar)?Y.value:M.showStar)),ae=async e=>{if(k||!M.name)return;if(0!==O.validator.getValidTriggerRules(X.value,e).length){L.value="validating";try{await O.validator.validate(X.value,{validateFirst:!0,value:C.value,name:M.name,label:M.label,trigger:e}),L.value="success",W.value=""}catch(a){L.value="error",W.value=a[0];throw{name:M.name,value:C.value,message:W.value}}}},te=()=>{L.value="",W.value="",k=!1},se=async()=>{k=!0,C.value=m(B),await A(),te()},le=o(),re=j(),ne=async()=>{var e;const[a,t,s]=await Promise.all([H(),N(`#${le}`,re),G()]),l=K(s.height,a.scrollTop,t.height,t.top+a.scrollTop,O.scrollIntoViewOptions);R({scrollTop:l,duration:(null==(e=O.scrollIntoViewOptions)?void 0:e.duration)??T.form.scrollDuration})},ie=d({name:u(M,"name"),validateMessage:W,validateState:L,validate:ae,clearValidate:te,reset:se,scrollToField:ne,onBlur:()=>{ae("blur").catch(P)},onChange:()=>{ae("change").catch(P)}});c((()=>{M.name&&(B=m(C.value),O.addField(ie))})),v((()=>{O.removeField(ie)})),g(J,ie),z({validate:ae,reset:se,clearValidate:te,scrollToField:ne,validateMessage:W,validateState:L});const oe=a((()=>M.direction||O.direction)),de=a((()=>f(q.b(),q.m(oe.value),q.m("inlaid",M.inlaid),q.m(`align-${M.labelAlign||O.labelAlign}`),q.m(`valign-${M.labelValign||O.labelValign}`),q.m(`star-${M.starPosition||O.starPosition}`),M.rootClass))),ue=a((()=>$(M.rootStyle))),ce=a((()=>$({width:"horizontal"===oe.value&&(M.labelWidth||O.labelWidth)})));return(e,a)=>{const t=I;return p(),h(t,{class:w(y(de)),style:x(y(ue)),id:y(le)},{default:b((()=>[e.$slots.label||!y(i)(e.label)?(p(),h(t,{key:0,class:w(y(q).e("label")),style:x(y(ce))},{default:b((()=>[y(ee)?(p(),h(t,{key:0,class:w(y(q).e("star"))},{default:b((()=>[S("*")])),_:1},8,["class"])):E("",!0),F(e.$slots,"label",{},(()=>[S(V(e.label),1)]),!0)])),_:3},8,["class","style"])):E("",!0),_(t,{class:w(y(q).e("content"))},{default:b((()=>[F(e.$slots,"default",{},void 0,!0),F(e.$slots,"validate",{state:L.value},void 0,!0),y(D)?(p(),h(t,{key:0,class:w(y(q).e("error"))},{default:b((()=>[S(V(W.value),1)])),_:1},8,["class"])):E("",!0)])),_:3},8,["class"])])),_:3},8,["class","style","id"])}}}),[["__scopeId","data-v-aff965eb"]]);let ee;function ae(e){return O(e)?e():e}function te(e,a,t){return q(t.len)?e===t.len||`${a}.len`:q(t.min)&&q(t.max)?!(e<t.min||e>t.max)||`${a}.range`:q(t.min)?!(e<t.min)||`${a}.min`:!q(t.max)||(!(e>t.max)||`${a}.max`)}const se={string:(e,a)=>!!M(e)&&te(e.length,"string",a),number:(e,a)=>!!q(e)&&te(e,"number",a),integer:(e,a)=>!!Number.isInteger(e)&&te(e,"number",a),float:(e,a)=>!(!Number.isFinite(e)||e%1==0)&&te(e,"number",a),boolean:e=>k(e),function:e=>O(e),regexp(e){if(!M(e))return e instanceof RegExp;try{return new RegExp(e),!0}catch{return!1}},array:(e,a)=>!!Array.isArray(e)&&te(e.length,"number",a),object:e=>e&&"object"==typeof e&&!Array.isArray(e),enum(e,a){var t;return!!(null==(t=a.enum)?void 0:t.includes(e))||"enum"},date:e=>e instanceof Date,url:e=>M(e)&&(()=>{if(ee)return ee;const e="[a-fA-F\\d:]",a=a=>a&&a.includeBoundaries?`(?:(?<=\\s|^)(?=${e})|(?<=${e})(?=\\s|$))`:"",t="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",s="[a-fA-F\\d]{1,4}",l=`\n(?:\n(?:${s}:){7}(?:${s}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${s}:){6}(?:${t}|:${s}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${s}:){5}(?::${t}|(?::${s}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${s}:){4}(?:(?::${s}){0,1}:${t}|(?::${s}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${s}:){3}(?:(?::${s}){0,2}:${t}|(?::${s}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${s}:){2}(?:(?::${s}){0,3}:${t}|(?::${s}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${s}:){1}(?:(?::${s}){0,4}:${t}|(?::${s}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${s}){0,5}:${t}|(?::${s}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),r=new RegExp(`(?:^${t}$)|(?:^${l}$)`),n=new RegExp(`^${t}$`),i=new RegExp(`^${l}$`),o=e=>e&&e.exact?r:new RegExp(`(?:${a(e)}${t}${a(e)})|(?:${a(e)}${l}${a(e)})`,"g");o.v4=e=>e&&e.exact?n:new RegExp(`${a(e)}${t}${a(e)}`,"g"),o.v6=e=>e&&e.exact?i:new RegExp(`${a(e)}${l}${a(e)}`,"g");const d=o.v4().source,u=o.v6().source;return ee=new RegExp(`(?:^(?:(?:(?:[a-z]+:)?//)|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|${d}|${u}|(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#][^\\s"]*)?$)`,"i"),ee})().test(e),hex:e=>M(e)&&/^#(?:[0-9A-F]{6}|[0-9A-F]{3})$/i.test(e),email:e=>M(e)&&/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)};class le{constructor(){this.validateMessages=void 0}setValidateMessages(e){this.validateMessages=e}getValidTriggerRules(e,a){let t=e;if(a){const l=s(a);t=e.filter(Boolean).filter((e=>{let{trigger:a}=e;return!a||(a=s(a),l.some((e=>a.includes(e))))}))}return t}validate(e,a={}){const{validateFirst:t,value:s}=a;return new Promise(((l,r)=>{t?Promise.all(e.map((e=>this.validateRule(s,e)))).then((()=>{l()})).catch((({error:e,rule:t})=>{r([this.replaceSymbol(e,t,a)])})):Promise.allSettled(e.map((e=>this.validateRule(s,e)))).then((e=>{const t=e.filter((({status:e})=>"rejected"===e));0===t.length?l():r(t.map((e=>{const{error:t,rule:s}=e.reason;return this.replaceSymbol(t,s,a)})))}))}))}validateRule(e,a){return a.transform&&(e=a.transform(e)),new Promise(((s,l)=>{const r=e=>{l({error:e,rule:a})};if(z(e,a.whitespace)&&!a.validator)return void(a.required?r(ae(a.message)||t(this.validateMessages,"required")):s());if(a.validator){const t=a.validator(e,a);return void(t instanceof Promise?t.then((()=>{s()})).catch((e=>{r(e)})):!0===t?s():M(t)?r(t):r(ae(a.message)))}if(a.pattern instanceof RegExp){return void(a.pattern.test(String(e))?s():r(ae(a.message)||t(this.validateMessages,"pattern.mismatch")))}let n=a.type;!n&&(q(a.min)||q(a.max)||q(a.len))&&(n="string"),n&&Object.keys(se).includes(n)?this.validateInternal(n,e,a).then((()=>{s()})).catch((e=>{r(ae(a.message)||e)})):s()}))}validateInternal(e,a,s){return new Promise(((l,r)=>{var n;const i=null==(n=se[e])?void 0:n.call(se,a,s);!0===i?l():r(t(this.validateMessages,M(i)?i:`types.${e}`))}))}replaceSymbol(e,a,t={}){var s;e instanceof Error&&(e=e.message),M(e)||(e=String(e));const l=M(t.label)?t.label:String(t.name),r={"${min}":a.min,"${max}":a.max,"${len}":a.len,"${enum}":a.enum,"${label}":l,"${value}":t.value,"${type}":a.type,"${pattern}":null==(s=a.pattern)?void 0:s.toString()};return e.replace(/\$\{(?:min|max|len|enum|label|value|type|pattern)\}/g,(e=>r[e]??""))}}const re=D(e({options:{virtualHost:!0,styleIsolation:"shared"},__name:"form",props:Q,setup(e,{expose:t}){const l=e,r=Z("form"),i=e=>{let a=m;return e&&e.length>0&&(a=m.filter((a=>e.findIndex((e=>W(s(a.name),s(e))))>-1))),a},o=async e=>{const a=(await Promise.allSettled(i(e).map((e=>e.validate())))).filter((e=>"rejected"===e.status));if(a.length>0){const e=a.map((e=>e.reason));throw l.scrollToFirstError&&c(e[0].name),e}},c=e=>{var a;null==(a=(e=>m.find((a=>W(s(a.name),s(e)))))(e))||a.scrollToField()};t({validate:o,reset:async e=>{await Promise.allSettled(i(e).map((e=>{e.reset()})))},clearValidate:async e=>{await Promise.allSettled(i(e).map((e=>{e.clearValidate()})))},scrollToField:c});const m=[],v=C(new le),{select:S}=B("form.defaultValidateMessages");v.setValidateMessages(S()),n((()=>l.rules),(()=>{l.validateOnRuleChange&&o().catch(P)}),{deep:!0}),g(X,d({model:u(l,"model"),rules:u(l,"rules"),validateTrigger:u(l,"validateTrigger"),direction:u(l,"direction"),labelWidth:u(l,"labelWidth"),labelAlign:u(l,"labelAlign"),labelValign:u(l,"labelValign"),starPosition:u(l,"starPosition"),showError:u(l,"showError"),scrollIntoViewOptions:u(l,"scrollIntoViewOptions"),disabled:u(l,"disabled"),readonly:u(l,"readonly"),addField:e=>{m.push(e)},removeField:e=>{m.splice(m.indexOf(e),1)},validator:v}));const E=a((()=>f(r.b(),r.m("card",l.card),l.rootClass))),V=a((()=>$(l.rootStyle)));return(e,a)=>{const t=I;return p(),h(t,{class:w(y(E)),style:x(y(V))},{default:b((()=>[F(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-b1987b3c"]]);export{Y as _,re as a};
