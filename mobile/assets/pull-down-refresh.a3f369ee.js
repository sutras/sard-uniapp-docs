import{a as e,e as o}from"./index.5a4c2473.js";import{E as s,g as a,p as t,A as n,M as l,q as r,s as u,ap as i,r as d,a as c,o as h,f as p,w as m,e as v,h as g,y,x as f,v as w,l as D}from"./index-aa8abc65.js";import{b as T,_ as b}from"./index.776be883.js";import{t as S}from"./dom.06da4e90.js";const M={rootStyle:[String,Object,Array],rootClass:String,threshold:{type:Number,default:s.pullDownRefresh.threshold},headerHeight:{type:Number,default:s.pullDownRefresh.headerHeight},loading:{type:Boolean,default:!1},transitionDuration:{type:Number,default:s.pullDownRefresh.transitionDuration},doneDuration:{type:Number,default:s.pullDownRefresh.doneDuration},disabled:{type:Boolean,default:!1}};const R=b({options:{virtualHost:!0,styleIsolation:"shared"},components:{SarLoading:e},props:M,emit:["refresh"],setup(e,{emit:s,expose:d}){const c=T("pull-down-refresh"),h=a("initial"),p=a(0),m=t((()=>Math.min(p.value/e.threshold,1))),[v,g]=o((()=>{h.value="initial"})),[y,f]=o((()=>{D()})),w=()=>{f(),g(),h.value="loading",p.value=e.headerHeight},D=()=>{h.value="recovering",p.value=0,v(e.transitionDuration)};n((()=>e.loading),(()=>{e.loading?w():(h.value="done",y(e.doneDuration))})),l((()=>{e.loading&&w()}));let b=0,M=0,R=!1,_="";const x=a(!1),k=o=>{!e.disabled&&"initial"===h.value&&L.value&&(b=o.touches[0].clientX,M=o.touches[0].clientY,R=!0)},C=o=>{if(!R||_&&"down"!==_)return;const s=o.touches[0].clientX-b,a=o.touches[0].clientY-M;if(!_){const e=Math.abs(a)>=Math.abs(s);_=e&&a>0?"down":"others"}if("down"===_){const s=Math.max(a,0)/2;h.value=s>=e.threshold?"ready":"unready",p.value=s,x.value=!0,o.preventDefault(),o.stopImmediatePropagation?o.stopImmediatePropagation():o.stopPropagation&&o.stopPropagation()}},E=()=>{switch(R=!1,_="",x.value=!1,h.value){case"unready":return void D();case"ready":return w(),void s("refresh")}},L=a(!0);d({enableToRefresh:e=>{L.value=e},_setStatus:e=>{h.value=e},_emit(e){s(e.name,e.payload)},_toRecovering:D,_toLoading:w,_setTranslateY:e=>{p.value=e}});const $=t((()=>r(c.b(),e.rootClass))),j=t((()=>u(e.rootStyle,{transform:`translate3d(0,${p.value}px,0)`,transitionDuration:(x.value?0:e.transitionDuration)+"ms"}))),H=t((()=>u({height:e.headerHeight+"px"}))),I=t((()=>r(c.e("loading"))));return{onTouchStart:k,onTouchMove:C,onTouchEnd:E,onMouseDown:e=>{const o=i();k(S(e,o.windowTop));const s=e=>{C(S(e,o.windowTop))},a=()=>{E(),document.removeEventListener("mouseup",a),document.removeEventListener("mousemove",s)};document.addEventListener("mousemove",s),document.addEventListener("mouseup",a)},status:h,progress:m,bem:c,pullDownRefreshClass:$,pullDownRefreshStyle:j,headerStyle:H,loadingClass:I,canRefresh:L}}},[["render",function(o,s,a,t,n,l){const r=d(c("sar-loading"),e),u=D;return h(),p(u,{class:g(t.pullDownRefreshClass),style:y(t.pullDownRefreshStyle),onTouchstart:t.onTouchStart,onTouchmove:t.onTouchMove,onTouchend:t.onTouchEnd,onTouchcancel:t.onTouchEnd,onMousedown:t.onMouseDown},{default:m((()=>[v(u,{class:g(t.bem.e("header")),style:y(t.headerStyle)},{default:m((()=>["unready"===t.status?f(o.$slots,"unready",{key:0,progress:t.progress},(()=>[v(r,{type:"clock",class:g(t.loadingClass),animated:!1,progress:t.progress},null,8,["class","progress"])]),!0):"ready"===t.status?f(o.$slots,"ready",{key:1},(()=>[v(r,{type:"clock",class:g(t.loadingClass),animated:!1},null,8,["class"])]),!0):"loading"===t.status?f(o.$slots,"loading",{key:2},(()=>[v(r,{type:"clock",class:g(t.loadingClass)},null,8,["class"])]),!0):"done"===t.status?f(o.$slots,"done",{key:3},void 0,!0):w("",!0)])),_:3},8,["class","style"]),f(o.$slots,"default",{},void 0,!0)])),_:3},8,["class","style","onTouchstart","onTouchmove","onTouchend","onTouchcancel","onMousedown"])}],["__scopeId","data-v-bc0cfeee"]]);export{R as _};
