var e=Object.defineProperty,a=(a,t,l)=>(((a,t,l)=>{t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l})(a,"symbol"!=typeof t?t+"":t,l),l);import{d as t,G as l,p as s,g as r,A as n,L as o,C as i,D as d,N as u,af as c,ag as m,B as v,o as g,f,w as p,u as $,y as h,h as b,x as y,i as w,s as x,v as S,t as E,e as V,ah as F,W as A,ai as P,$ as R,aj as T,E as _,H as B,q as I,z as j,l as z,M,ak as O,al as q,am as C,an as W,ao as k,ap as D,V as H,a5 as N}from"./index-cDBoG4Q4.js";import{b as Z,_ as G}from"./index.DPvFFOke.js";import{b as L,g as J,a as K,c as Q}from"./dom.v6hFRhZS.js";import{a as U,f as X,b as Y,c as ee,d as ae}from"./common.C5AqtFVf.js";const te=G(t({options:{virtualHost:!0,styleIsolation:"shared"},__name:"form-item",props:l({rootStyle:{},rootClass:{},direction:{},labelWidth:{},labelAlign:{},labelValign:{},starPosition:{},showStar:{type:Boolean},label:{},required:{type:Boolean},name:{},rules:{},validateTrigger:{},error:{},showError:{type:Boolean},inlaid:{type:Boolean}},Y),setup(e,{expose:a}){const t=e,l=Z("form-item"),O=U();if(!O)throw new Error("FormItem must be included in Form.");let q=!1;const C=s({get(){const e=O.model;if(e&&t.name)return F(e,A(t.name))},set(e){const a=O.model;a&&t.name&&P(a,A(t.name),e)}});let W;const k=r("");n((()=>t.error),(()=>{k.value=t.error||"",H.value=t.error?"error":""}));const D=s((()=>(t.showError??O.showError)&&k.value)),H=r(""),N=s((()=>{const e=t.validateTrigger??O.validateTrigger;return e?A(e):void 0})),G=s((()=>{const e=[];t.rules&&e.push(...A(t.rules));const a=O.rules;if(a&&t.name){const l=F(a,A(t.name));l&&e.push(...A(l))}const l=t.required;if(void 0!==l){const a=e.map(((e,a)=>[e,a])).filter((([e])=>Object.keys(e).includes("required")));if(a.length>0)for(const[t,s]of a)t.required!==l&&(e[s]={...t,required:l});else e.push({required:l})}const s=N.value;if(s&&s.length>0)for(let t=0,r=e.length;t<r;t++){const a=e[t];a.trigger||(e[t]={...a,trigger:[...s]})}return e})),Y=s((()=>G.value.some((e=>e.required)))),ee=s((()=>h(t.showStar)?Y.value:t.showStar)),ae=async e=>{if(q||!t.name)return;if(0!==O.validator.getValidTriggerRules(G.value,e).length){H.value="validating";try{await O.validator.validate(G.value,{validateFirst:!0,value:C.value,name:t.name,label:t.label,trigger:e}),H.value="success",k.value=""}catch(a){H.value="error",k.value=a[0];throw{name:t.name,value:C.value,message:k.value}}}},te=()=>{H.value="",k.value="",q=!1},le=async()=>{q=!0,C.value=c(W),await R(),te()},se=o(),re=M(),ne=async()=>{var e;const[a,t,l]=await Promise.all([L(),J(`#${se}`,re),K()]),s=Q(l.height,a.scrollTop,t.height,t.top+a.scrollTop,O.scrollIntoViewOptions);T({scrollTop:s,duration:(null==(e=O.scrollIntoViewOptions)?void 0:e.duration)??_.form.scrollDuration})},oe=i({name:d(t,"name"),validateMessage:k,validateState:H,validate:ae,clearValidate:te,reset:le,scrollToField:ne,onBlur:()=>{ae("blur").catch(B)},onChange:()=>{ae("change").catch(B)}});u((()=>{t.name&&(W=c(C.value),O.addField(oe))})),m((()=>{O.removeField(oe)})),v(X,oe),a({validate:ae,reset:le,clearValidate:te,scrollToField:ne,validateMessage:k,validateState:H});const ie=s((()=>t.direction||O.direction)),de=s((()=>I(l.b(),l.m(ie.value),l.m("inlaid",t.inlaid),l.m(`align-${t.labelAlign||O.labelAlign}`),l.m(`valign-${t.labelValign||O.labelValign}`),l.m(`star-${t.starPosition||O.starPosition}`),t.rootClass))),ue=s((()=>j(t.rootStyle))),ce=s((()=>j({width:"horizontal"===ie.value&&(t.labelWidth||O.labelWidth)})));return(e,a)=>{const t=z;return g(),f(t,{class:b(de.value),style:y(ue.value),id:$(se)},{default:p((()=>[e.$slots.label||!$(h)(e.label)?(g(),f(t,{key:0,class:b($(l).e("label")),style:y(ce.value)},{default:p((()=>[ee.value?(g(),f(t,{key:0,class:b($(l).e("star"))},{default:p((()=>[w("*")])),_:1},8,["class"])):x("",!0),S(e.$slots,"label",{},(()=>[w(E(e.label),1)]),!0)])),_:3},8,["class","style"])):x("",!0),V(t,{class:b($(l).e("content"))},{default:p((()=>[S(e.$slots,"default",{},void 0,!0),S(e.$slots,"validate",{state:H.value},void 0,!0),D.value?(g(),f(t,{key:0,class:b($(l).e("error"))},{default:p((()=>[w(E(k.value),1)])),_:1},8,["class"])):x("",!0)])),_:3},8,["class"])])),_:3},8,["class","style","id"])}}}),[["__scopeId","data-v-532e628d"]]);let le;function se(e){return W(e)?e():e}function re(e,a,t){return C(t.len)?e===t.len||`${a}.len`:C(t.min)&&C(t.max)?!(e<t.min||e>t.max)||`${a}.range`:C(t.min)?!(e<t.min)||`${a}.min`:!C(t.max)||(!(e>t.max)||`${a}.max`)}const ne={string:(e,a)=>!!q(e)&&re(e.length,"string",a),number:(e,a)=>!!C(e)&&re(e,"number",a),integer:(e,a)=>!!Number.isInteger(e)&&re(e,"number",a),float:(e,a)=>!(!Number.isFinite(e)||e%1==0)&&re(e,"number",a),boolean:e=>k(e),function:e=>W(e),regexp(e){if(!q(e))return e instanceof RegExp;try{return new RegExp(e),!0}catch{return!1}},array:(e,a)=>!!Array.isArray(e)&&re(e.length,"number",a),object:e=>e&&"object"==typeof e&&!Array.isArray(e),enum(e,a){var t;return!!(null==(t=a.enum)?void 0:t.includes(e))||"enum"},date:e=>e instanceof Date,url:e=>q(e)&&(()=>{if(le)return le;const e="[a-fA-F\\d:]",a=a=>a&&a.includeBoundaries?`(?:(?<=\\s|^)(?=${e})|(?<=${e})(?=\\s|$))`:"",t="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",l="[a-fA-F\\d]{1,4}",s=`\n(?:\n(?:${l}:){7}(?:${l}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${l}:){6}(?:${t}|:${l}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${l}:){5}(?::${t}|(?::${l}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${l}:){4}(?:(?::${l}){0,1}:${t}|(?::${l}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${l}:){3}(?:(?::${l}){0,2}:${t}|(?::${l}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${l}:){2}(?:(?::${l}){0,3}:${t}|(?::${l}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${l}:){1}(?:(?::${l}){0,4}:${t}|(?::${l}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${l}){0,5}:${t}|(?::${l}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),r=new RegExp(`(?:^${t}$)|(?:^${s}$)`),n=new RegExp(`^${t}$`),o=new RegExp(`^${s}$`),i=e=>e&&e.exact?r:new RegExp(`(?:${a(e)}${t}${a(e)})|(?:${a(e)}${s}${a(e)})`,"g");i.v4=e=>e&&e.exact?n:new RegExp(`${a(e)}${t}${a(e)}`,"g"),i.v6=e=>e&&e.exact?o:new RegExp(`${a(e)}${s}${a(e)}`,"g");const d=i.v4().source,u=i.v6().source;return le=new RegExp(`(?:^(?:(?:(?:[a-z]+:)?//)|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|${d}|${u}|(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#][^\\s"]*)?$)`,"i"),le})().test(e),hex:e=>q(e)&&/^#(?:[0-9A-F]{6}|[0-9A-F]{3})$/i.test(e),email:e=>q(e)&&/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)};class oe{constructor(){a(this,"validateMessages")}setValidateMessages(e){this.validateMessages=e}getValidTriggerRules(e,a){let t=e;if(a){const l=A(a);t=e.filter(Boolean).filter((e=>{let{trigger:a}=e;return!a||(a=A(a),l.some((e=>a.includes(e))))}))}return t}validate(e,a={}){const{validateFirst:t,value:l}=a;return new Promise(((s,r)=>{t?Promise.all(e.map((e=>this.validateRule(l,e)))).then((()=>{s()})).catch((({error:e,rule:t})=>{r([this.replaceSymbol(e,t,a)])})):Promise.allSettled(e.map((e=>this.validateRule(l,e)))).then((e=>{const t=e.filter((({status:e})=>"rejected"===e));0===t.length?s():r(t.map((e=>{const{error:t,rule:l}=e.reason;return this.replaceSymbol(t,l,a)})))}))}))}validateRule(e,a){return a.transform&&(e=a.transform(e)),new Promise(((t,l)=>{const s=e=>{l({error:e,rule:a})};if(O(e,a.whitespace)&&!a.validator)return void(a.required?s(se(a.message)||F(this.validateMessages,"required")):t());if(a.validator){const l=a.validator(e,a);return void(l instanceof Promise?l.then((()=>{t()})).catch((e=>{s(e)})):!0===l?t():q(l)?s(l):s(se(a.message)))}if(a.pattern instanceof RegExp){return void(a.pattern.test(String(e))?t():s(se(a.message)||F(this.validateMessages,"pattern.mismatch")))}let r=a.type;!r&&(C(a.min)||C(a.max)||C(a.len))&&(r="string"),r&&Object.keys(ne).includes(r)?this.validateInternal(r,e,a).then((()=>{t()})).catch((e=>{s(se(a.message)||e)})):t()}))}validateInternal(e,a,t){return new Promise(((l,s)=>{var r;const n=null==(r=ne[e])?void 0:r.call(ne,a,t);!0===n?l():s(F(this.validateMessages,q(n)?n:`types.${e}`))}))}replaceSymbol(e,a,t={}){var l;e instanceof Error&&(e=e.message),q(e)||(e=String(e));const s=q(t.label)?t.label:String(t.name),r={"${min}":a.min,"${max}":a.max,"${len}":a.len,"${enum}":a.enum,"${label}":s,"${value}":t.value,"${type}":a.type,"${pattern}":null==(l=a.pattern)?void 0:l.toString()};return e.replace(/\$\{(?:min|max|len|enum|label|value|type|pattern)\}/g,(e=>r[e]??""))}}const ie=G(t({options:{virtualHost:!0,styleIsolation:"shared"},__name:"form",props:l({rootStyle:{},rootClass:{},model:{},rules:{},validateTrigger:{},validateOnRuleChange:{type:Boolean},direction:{},labelWidth:{},labelAlign:{},labelValign:{},starPosition:{},showError:{type:Boolean},scrollToFirstError:{type:Boolean},scrollIntoViewOptions:{},disabled:{type:Boolean},readonly:{type:Boolean},card:{type:Boolean}},ae),setup(e,{expose:a}){const t=e,l=Z("form"),r=e=>{let a=c;return e&&e.length>0&&(a=c.filter((a=>e.findIndex((e=>N(A(a.name),A(e))))>-1))),a},o=async e=>{const a=(await Promise.allSettled(r(e).map((e=>e.validate())))).filter((e=>"rejected"===e.status));if(a.length>0){const e=a.map((e=>e.reason));throw t.scrollToFirstError&&u(e[0].name),e}},u=e=>{var a;null==(a=(e=>c.find((a=>N(A(a.name),A(e)))))(e))||a.scrollToField()};a({validate:o,reset:async e=>{await Promise.allSettled(r(e).map((e=>{e.reset()})))},clearValidate:async e=>{await Promise.allSettled(r(e).map((e=>{e.clearValidate()})))},scrollToField:u});const c=[],m=D(new oe),{select:$}=H("form.defaultValidateMessages");m.setValidateMessages($()),n((()=>t.rules),(()=>{t.validateOnRuleChange&&o().catch(B)}),{deep:!0}),v(ee,i({model:d(t,"model"),rules:d(t,"rules"),validateTrigger:d(t,"validateTrigger"),direction:d(t,"direction"),labelWidth:d(t,"labelWidth"),labelAlign:d(t,"labelAlign"),labelValign:d(t,"labelValign"),starPosition:d(t,"starPosition"),showError:d(t,"showError"),scrollIntoViewOptions:d(t,"scrollIntoViewOptions"),disabled:d(t,"disabled"),readonly:d(t,"readonly"),addField:e=>{c.push(e)},removeField:e=>{c.splice(c.indexOf(e),1)},validator:m}));const h=s((()=>I(l.b(),l.m("card",t.card),t.rootClass))),w=s((()=>j(t.rootStyle)));return(e,a)=>{const t=z;return g(),f(t,{class:b(h.value),style:y(w.value)},{default:p((()=>[S(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-948f4707"]]);export{te as _,ie as a};
