import{d as e,p as a,J as l,g as s,ap as t,q as o,s as i,o as r,f as n,w as u,u as c,h as d,e as m,i as p,t as f,v,y,K as g,j as h,aq as b,l as _,ar as x,a3 as S,as as z,A as F,c as k,F as T,b as R,x as C,E as w,at as E}from"./index-55845ce0.js";import{i as I,b as j,_ as A,a as B,g as N}from"./index.f4d2668a.js";import{a as P}from"./index.f5b2fbd4.js";import{_ as V}from"./_plugin-vue_export-helper.1b428a4d.js";import{a as D,u as q}from"./common.bcce75e7.js";const O={rootStyle:[String,Object,Array],rootClass:String,accept:{type:String,default:"image"},multiple:Boolean,sourceType:{type:Array,default:()=>["album","camera"]},sizeType:{type:Array,default:()=>["original","compressed"]},maxDuration:{type:Number,default:60},camera:String,modelValue:Array,maxCount:{type:Number,default:Number.MAX_SAFE_INTEGER},maxSize:{type:[Number,Function],default:Number.MAX_SAFE_INTEGER},overSize:Function,disabled:Boolean,readonly:Boolean,beforeRead:Function,afterRead:Function,removable:{type:Boolean,default:!0},beforeRemove:Function,validateEvent:{type:Boolean,default:!0}},G=V(e({options:{virtualHost:!0,styleIsolation:"shared"},__name:"upload-preview",props:{rootStyle:[String,Object,Array],rootClass:String,file:Object,url:String,isImage:Boolean,isVideo:Boolean,status:{type:String,default:"pending"},name:String,message:String,removable:Boolean,beforeRemove:Function,index:{type:Number,required:!0},disabled:Boolean,readonly:Boolean},emits:["image-click","remove"],setup(e,{emit:x}){const S=e,z=B("upload"),F=a((()=>{var e;return S.isImage||"image"===(null==(e=S.file)?void 0:e.type)||S.url&&I(S.url)})),k=a((()=>{var e;return S.isVideo||"video"===(null==(e=S.file)?void 0:e.type)||S.url&&j(S.url)})),T=a((()=>{var e;return S.url||(null==(e=S.file)?void 0:e.path)||""})),R=()=>{x("image-click",S.index)},C=l(),w=g(),E=s(!1),N=t(C,w),V=e=>{e.detail.fullScreen?(N.play(),E.value=!0):(N.pause(),E.value=!1)},D=()=>{N.requestFullScreen({direction:0})},q=()=>{if(S.removable&&!S.disabled&&!S.readonly){if(S.beforeRemove){const a=S.beforeRemove(S.index);if(!a)return;if(a instanceof Promise)return void a.then((()=>{e()})).catch((()=>{}))}e()}function e(){x("remove",S.index)}},O=a((()=>o(z.e("preview"),z.em("preview","is-video",k.value),S.rootClass))),G=a((()=>i(S.rootStyle)));return(e,a)=>{const l=h,s=b,t=_;return r(),n(t,{class:d(c(O)),style:y(c(G))},{default:u((()=>[c(F)?(r(),n(l,{key:0,mode:"aspectFill",src:c(T),onClick:R},null,8,["src"])):c(k)?(r(),n(t,{key:1,class:d(c(z).e("video-wrapper"))},{default:u((()=>[m(s,{class:d(c(z).e("video")),id:c(C),src:c(T),controls:E.value,"show-center-play-btn":!1,onFullscreenchange:V},null,8,["class","id","src","controls"]),m(t,{class:d(c(z).e("video-play")),onClick:D},{default:u((()=>[m(A,{name:"play",size:"80rpx"})])),_:1},8,["class"])])),_:1},8,["class"])):(r(),n(t,{key:2,class:d(c(z).e("file"))},{default:u((()=>[m(t,{class:d(c(z).e("file-icon"))},{default:u((()=>[m(A,{name:"file"})])),_:1},8,["class"]),m(t,{class:d(c(z).e("file-name"))},{default:u((()=>[p(f(e.name),1)])),_:1},8,["class"])])),_:1},8,["class"])),"uploading"===e.status||"failed"===e.status?(r(),n(t,{key:3,class:d(c(z).e("status"))},{default:u((()=>[m(t,{class:d(c(z).e("status-icon"))},{default:u((()=>["uploading"===e.status?(r(),n(P,{key:0})):"failed"===e.status?(r(),n(A,{key:1,name:"x-circle"})):v("",!0)])),_:1},8,["class"]),e.message?(r(),n(t,{key:0,class:d(c(z).e("status-message"))},{default:u((()=>[p(f(e.message),1)])),_:1},8,["class"])):v("",!0)])),_:1},8,["class"])):v("",!0),!e.removable||e.disabled||e.readonly||"uploading"===e.status?v("",!0):(r(),n(t,{key:4,class:d(c(z).e("remove")),onClick:q},{default:u((()=>[m(t,{class:d(c(z).e("close"))},{default:u((()=>[m(A,{name:"close"})])),_:1},8,["class"])])),_:1},8,["class"]))])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-f4be52b8"]]);const H=V(e({options:{virtualHost:!0,styleIsolation:"shared"},__name:"upload",props:O,emits:["update:model-value","remove"],setup(e,{emit:l}){const t=e,p=B("upload"),f=D(),g=q(),h=a((()=>(null==f?void 0:f.disabled)??t.disabled)),b=a((()=>(null==f?void 0:f.readonly)??t.readonly)),j=s(t.modelValue||[]);F((()=>t.modelValue),(()=>{j.value=t.modelValue||[],t.validateEvent&&(null==g||g.onChange())}));const P=(e,a)=>{const l=t.maxCount-j.value.length;e.length>l&&(e=e.slice(0,l)),a(e)},V=(e,a)=>{Promise.allSettled(e.map((e=>new Promise(((a,l)=>{if(t.beforeRead){const s=t.beforeRead(e);if(!s)return void l();if(s instanceof Promise)return void s.then((l=>{a(l??e)})).catch((()=>{l()}))}a(e)}))))).then((e=>{const l=[];e.forEach((e=>{"fulfilled"===e.status&&l.push(e.value)})),a(l)}))},O=(e,a)=>{a(e.map((e=>({file:e,name:e.path&&N(e.path)}))))},H=(e,a)=>{var s;const o=[],i=[];e.forEach((e=>{const a=e.file;a&&("function"==typeof t.maxSize&&t.maxSize(a)||a.size&&"number"==typeof t.maxSize&&a.size>t.maxSize)?i.push(e):o.push(e)})),i.length&&(null==(s=t.overSize)||s.call(t,i)),o.length&&(j.value=[...j.value,...o],l("update:model-value",j.value),a(o))},M=e=>{S(e).forEach((e=>{var a;null==(a=t.afterRead)||a.call(t,e)}))};const X=()=>{h.value||b.value||j.value.length>=t.maxCount||function(e){const{count:a=9,mediaType:l="image",sourceType:s=["album","camera"],maxDuration:t=10,sizeType:o=["original","compressed"],camera:i="back",success:r,fail:n,complete:u}=e;"image"===l?x({count:a,sizeType:o,sourceType:s,success(e){null==r||r({type:"image",tempFiles:S(e.tempFiles).map((e=>({tempFilePath:e.path,size:e.size,duration:0,height:0,width:0,fileType:"image"})))})},fail:n,complete:u}):z({sourceType:s,compressed:o.includes("compressed"),maxDuration:t,camera:i,success(e){null==r||r({type:"video",tempFiles:[{tempFilePath:e.tempFilePath,size:e.size,duration:e.duration,height:e.height,width:e.width,fileType:"video"}]})},fail:n,complete:u})}({mediaType:t.accept,count:t.multiple?9999:1,sizeType:t.sizeType,sourceType:t.sourceType,maxDuration:t.maxDuration,camera:t.camera,success(e){var a;a=e.tempFiles.map((e=>({type:e.fileType,size:e.size,path:e.tempFilePath,duration:e.duration,width:e.width,height:e.height}))),[P,V,O,H,M].reduceRight(((e,a)=>l=>{a(l,e)}),(()=>{}))(a)},fail:w})},J=e=>{const a=j.value[e],l=j.value.filter((e=>{var a;return e.url&&I(e.url)||"image"===(null==(a=e.file)?void 0:a.type)})),s=l.findIndex((e=>e===a)),t=l.map((e=>{var a;return e.url||(null==(a=e.file)?void 0:a.path)}));E({urls:t,current:t[s]})},K=a((()=>o(p.b(),p.m("disabled",h.value),p.m("readonly",b.value),t.rootClass))),$=a((()=>i(t.rootStyle)));return(e,a)=>{const s=_;return r(),n(s,{class:d(c(K)),style:y(c($))},{default:u((()=>[m(s,{class:d(c(p).e("wrapper"))},{default:u((()=>[(r(!0),k(T,null,R(j.value,((a,s)=>(r(),n(G,{key:s,file:a.file,url:a.url,"is-image":a.isImage,"is-video":a.isVideo,status:a.status,name:a.name,message:a.message,removable:e.removable,"before-remove":e.beforeRemove,index:s,disabled:c(h),readonly:c(b),onRemove:e=>((e,a)=>{const s=j.value.filter(((a,l)=>l!==e));j.value=s,l("update:model-value",s),l("remove",e,a)})(s,a),onImageClick:J},null,8,["file","url","is-image","is-video","status","name","message","removable","before-remove","index","disabled","readonly","onRemove"])))),128)),j.value.length<e.maxCount?(r(),n(s,{key:0,class:d(c(p).e("select")),onClick:X},{default:u((()=>[C(e.$slots,"select",{},(()=>[m(s,{class:d(c(p).e("select-icon"))},{default:u((()=>[m(A,{name:"plus"})])),_:1},8,["class"])]),!0)])),_:3},8,["class"])):v("",!0)])),_:3},8,["class"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-303850e7"]]);export{H as _};
