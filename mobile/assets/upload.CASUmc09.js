import{E as e,d as a,G as s,p as l,L as t,g as o,as as i,o as u,f as n,w as r,h as c,u as d,e as m,i as p,t as v,s as f,x as y,M as h,q as g,z as b,j as x,at as _,l as z,au as k,W as F,av as T,A as w,c as C,F as S,b as R,v as B,H as I,aw as P}from"./index-cDBoG4Q4.js";import{a as V,b as E,i as j,d as D,_ as H,g as q}from"./index.DPvFFOke.js";import{a as A}from"./index.BXD0v1E4.js";import{a as G,u as L}from"./common.C5AqtFVf.js";const M=e.upload,N=e.uploadPreview,W=H(a({options:{virtualHost:!0,styleIsolation:"shared"},__name:"upload-preview",props:s({rootStyle:{},rootClass:{},file:{},url:{},isImage:{type:Boolean},isVideo:{type:Boolean},status:{},name:{},message:{},removable:{type:Boolean},beforeRemove:{type:Function},index:{},disabled:{type:Boolean},readonly:{type:Boolean}},N),emits:["image-click","remove"],setup(e,{emit:a}){const s=e,k=a,F=E("upload"),T=l((()=>{var e;return s.isImage||"image"===(null==(e=s.file)?void 0:e.type)||s.url&&j(s.url)})),w=l((()=>{var e;return s.isVideo||"video"===(null==(e=s.file)?void 0:e.type)||s.url&&D(s.url)})),C=l((()=>{var e;return s.url||(null==(e=s.file)?void 0:e.path)||""})),S=()=>{k("image-click",s.index)},R=t(),B=h(),I=o(!1),P=i(R,B),H=e=>{e.detail.fullScreen?(P.play(),I.value=!0):(P.pause(),I.value=!1)},q=()=>{P.requestFullScreen({direction:0})},G=()=>{if(s.removable&&!s.disabled&&!s.readonly){if(s.beforeRemove){const a=s.beforeRemove(s.index);if(!a)return;if(a instanceof Promise)return void a.then((()=>{e()})).catch((()=>{}))}e()}function e(){k("remove",s.index)}},L=l((()=>g(F.e("preview"),F.em("preview","is-video",w.value),s.rootClass))),M=l((()=>b(s.rootStyle)));return(e,a)=>{const s=x,l=_,t=z;return u(),n(t,{class:c(L.value),style:y(M.value)},{default:r((()=>[T.value?(u(),n(s,{key:0,class:c(d(F).e("image")),mode:"aspectFill",src:C.value,onClick:S},null,8,["class","src"])):w.value?(u(),n(t,{key:1,class:c(d(F).e("video-wrapper"))},{default:r((()=>[m(l,{class:c(d(F).e("video")),id:d(R),src:C.value,controls:I.value,"show-center-play-btn":!1,onFullscreenchange:H},null,8,["class","id","src","controls"]),m(t,{class:c(d(F).e("video-play")),onClick:q},{default:r((()=>[m(V,{name:"play",size:"80rpx"})])),_:1},8,["class"])])),_:1},8,["class"])):(u(),n(t,{key:2,class:c(d(F).e("file"))},{default:r((()=>[m(t,{class:c(d(F).e("file-icon"))},{default:r((()=>[m(V,{name:"file"})])),_:1},8,["class"]),m(t,{class:c(d(F).e("file-name"))},{default:r((()=>[p(v(e.name),1)])),_:1},8,["class"])])),_:1},8,["class"])),"uploading"===e.status||"failed"===e.status?(u(),n(t,{key:3,class:c(d(F).e("status"))},{default:r((()=>[m(t,{class:c(d(F).e("status-icon"))},{default:r((()=>["uploading"===e.status?(u(),n(A,{key:0})):"failed"===e.status?(u(),n(V,{key:1,name:"x-circle"})):f("",!0)])),_:1},8,["class"]),e.message?(u(),n(t,{key:0,class:c(d(F).e("status-message"))},{default:r((()=>[p(v(e.message),1)])),_:1},8,["class"])):f("",!0)])),_:1},8,["class"])):f("",!0),!e.removable||e.disabled||e.readonly||"uploading"===e.status?f("",!0):(u(),n(t,{key:4,class:c(d(F).e("remove")),onClick:G},{default:r((()=>[m(t,{class:c(d(F).e("close"))},{default:r((()=>[m(V,{name:"close"})])),_:1},8,["class"])])),_:1},8,["class"]))])),_:1},8,["class","style"])}}}),[["__scopeId","data-v-a1fdfb17"]]);const $=H(a({options:{virtualHost:!0,styleIsolation:"shared"},__name:"upload",props:s({rootStyle:{},rootClass:{},accept:{},multiple:{type:Boolean},sourceType:{},sizeType:{},maxDuration:{},camera:{},modelValue:{},maxCount:{},maxSize:{type:[Number,Function]},overSize:{type:Function},disabled:{type:Boolean},readonly:{type:Boolean},beforeRead:{type:Function},afterRead:{type:Function},removable:{type:Boolean},beforeRemove:{type:Function},validateEvent:{type:Boolean}},M),emits:["update:model-value","remove"],setup(e,{emit:a}){const s=e,t=a,i=E("upload"),p=G(),v=L(),h=l((()=>(null==p?void 0:p.disabled)??s.disabled)),x=l((()=>(null==p?void 0:p.readonly)??s.readonly)),_=o(s.modelValue||[]);w((()=>s.modelValue),(()=>{_.value=s.modelValue||[],s.validateEvent&&(null==v||v.onChange())}));const D=(e,a)=>{const l=s.maxCount-_.value.length;e.length>l&&(e=e.slice(0,l)),a(e)},H=(e,a)=>{Promise.allSettled(e.map((e=>new Promise(((a,l)=>{if(s.beforeRead){const t=s.beforeRead(e);if(!t)return void l();if(t instanceof Promise)return void t.then((s=>{a(s??e)})).catch((()=>{l()}))}a(e)}))))).then((e=>{const s=[];e.forEach((e=>{"fulfilled"===e.status&&s.push(e.value)})),a(s)}))},A=(e,a)=>{a(e.map((e=>({file:e,name:e.path&&q(e.path)}))))},M=(e,a)=>{var l;const o=[],i=[];e.forEach((e=>{const a=e.file;a&&("function"==typeof s.maxSize&&s.maxSize(a)||a.size&&"number"==typeof s.maxSize&&a.size>s.maxSize)?i.push(e):o.push(e)})),i.length&&(null==(l=s.overSize)||l.call(s,i)),o.length&&(_.value=[..._.value,...o],t("update:model-value",_.value),a(o))},N=e=>{F(e).forEach((e=>{var a;null==(a=s.afterRead)||a.call(s,e)}))};const $=()=>{h.value||x.value||_.value.length>=s.maxCount||function(e){const{count:a=9,mediaType:s="image",sourceType:l=["album","camera"],maxDuration:t=10,sizeType:o=["original","compressed"],camera:i="back",success:u,fail:n,complete:r}=e;"image"===s?k({count:a,sizeType:o,sourceType:l,success(e){null==u||u({type:"image",tempFiles:F(e.tempFiles).map((e=>({tempFilePath:e.path,size:e.size,duration:0,height:0,width:0,fileType:"image"})))})},fail:n,complete:r}):T({sourceType:l,compressed:o.includes("compressed"),maxDuration:t,camera:i,success(e){null==u||u({type:"video",tempFiles:[{tempFilePath:e.tempFilePath,size:e.size,duration:e.duration,height:e.height,width:e.width,fileType:"video"}]})},fail:n,complete:r})}({mediaType:s.accept,count:s.multiple?9999:1,sizeType:s.sizeType,sourceType:s.sourceType,maxDuration:s.maxDuration,camera:s.camera,success(e){var a;a=e.tempFiles.map((e=>({type:e.fileType,size:e.size,path:e.tempFilePath,duration:e.duration,width:e.width,height:e.height}))),[D,H,A,M,N].reduceRight(((e,a)=>s=>{a(s,e)}),(()=>{}))(a)},fail:I})},J=e=>{const a=_.value[e],s=_.value.filter((e=>{var a;return e.url&&j(e.url)||"image"===(null==(a=e.file)?void 0:a.type)})),l=s.findIndex((e=>e===a)),t=s.map((e=>{var a;return e.url||(null==(a=e.file)?void 0:a.path)}));P({urls:t,current:t[l]})},K=l((()=>g(i.b(),i.m("disabled",h.value),i.m("readonly",x.value),s.rootClass))),O=l((()=>b(s.rootStyle)));return(e,a)=>{const s=z;return u(),n(s,{class:c(K.value),style:y(O.value)},{default:r((()=>[m(s,{class:c(d(i).e("wrapper"))},{default:r((()=>[(u(!0),C(S,null,R(_.value,((a,s)=>(u(),n(W,{key:s,file:a.file,url:a.url,"is-image":a.isImage,"is-video":a.isVideo,status:a.status,name:a.name,message:a.message,removable:e.removable,"before-remove":e.beforeRemove,index:s,disabled:h.value,readonly:x.value,onRemove:e=>((e,a)=>{const s=_.value.filter(((a,s)=>s!==e));_.value=s,t("update:model-value",s),t("remove",e,a)})(s,a),onImageClick:J},null,8,["file","url","is-image","is-video","status","name","message","removable","before-remove","index","disabled","readonly","onRemove"])))),128)),_.value.length<e.maxCount?(u(),n(s,{key:0,class:c(d(i).e("select")),onClick:$},{default:r((()=>[B(e.$slots,"select",{},(()=>[m(s,{class:c(d(i).e("select-icon"))},{default:r((()=>[m(V,{name:"plus"})])),_:1},8,["class"])]),!0)])),_:3},8,["class"])):f("",!0)])),_:3},8,["class"])])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-a7749c92"]]);export{$ as _};
