import{d as e,p as a,ac as t,a3 as s,ad as l,g as r,A as n,z as i,J as o,C as d,D as u,L as c,ae as m,af as g,B as v,q as f,s as $,o as p,f as h,w as b,u as y,h as w,y as x,i as S,v as _,x as E,t as F,e as V,Z as A,ag as R,E as P,l as T,K as I,ah as j,ai as z,aj as M,ak as q,al as O,am as k,S as C,a4 as B}from"./index-55845ce0.js";import{a as W}from"./index.f4d2668a.js";import{b as Z,g as D,a as H,c as N}from"./dom.7fe67c3f.js";import{f as J,a as K,b as L,c as G,d as Q}from"./common.bcce75e7.js";import{_ as U}from"./_plugin-vue_export-helper.1b428a4d.js";const X=U(e({options:{virtualHost:!0,styleIsolation:"shared"},__name:"form-item",props:J,setup(e,{expose:j}){const z=e,M=W("form-item"),q=K();if(!q)throw new Error("FormItem must be included in Form.");let O=!1;const k=a({get(){const e=q.model;if(e&&z.name)return t(e,s(z.name))},set(e){const a=q.model;a&&z.name&&l(a,s(z.name),e)}});let C;const B=r("");n((()=>z.error),(()=>{B.value=z.error||"",G.value=z.error?"error":""}));const J=a((()=>(z.showError??q.showError)&&B.value)),G=r(""),Q=a((()=>{const e=z.validateTrigger??q.validateTrigger;return e?s(e):void 0})),U=a((()=>{const e=[];z.rules&&e.push(...s(z.rules));const a=q.rules;if(a&&z.name){const l=t(a,s(z.name));l&&e.push(...s(l))}const l=z.required;if(void 0!==l){const a=e.map(((e,a)=>[e,a])).filter((([e])=>Object.keys(e).includes("required")));if(a.length>0)for(const[t,s]of a)t.required!==l&&(e[s]={...t,required:l});else e.push({required:l})}const r=Q.value;if(r&&r.length>0)for(let t=0,s=e.length;t<s;t++){const a=e[t];a.trigger||(e[t]={...a,trigger:[...r]})}return e})),X=a((()=>U.value.some((e=>e.required)))),Y=a((()=>i(z.showStar)?X.value:z.showStar)),ee=async e=>{if(O||!z.name)return;if(0!==q.validator.getValidTriggerRules(U.value,e).length){G.value="validating";try{await q.validator.validate(U.value,{validateFirst:!0,value:k.value,name:z.name,label:z.label,trigger:e}),G.value="success",B.value=""}catch(a){G.value="error",B.value=a[0];throw{name:z.name,value:k.value,message:B.value}}}},ae=()=>{G.value="",B.value="",O=!1},te=async()=>{O=!0,k.value=m(C),await A(),ae()},se=o(),le=I(),re=async()=>{var e;const[a,t,s]=await Promise.all([Z(),D(`#${se}`,le),H()]),l=N(s.height,a.scrollTop,t.height,t.top+a.scrollTop,q.scrollIntoViewOptions);R({scrollTop:l,duration:(null==(e=q.scrollIntoViewOptions)?void 0:e.duration)??300})},ne=d({name:u(z,"name"),validateMessage:B,validateState:G,validate:ee,clearValidate:ae,reset:te,scrollToField:re,onBlur:()=>{ee("blur").catch(P)},onChange:()=>{ee("change").catch(P)}});c((()=>{z.name&&(C=m(k.value),q.addField(ne))})),g((()=>{q.removeField(ne)})),v(L,ne),j({validate:ee,reset:te,clearValidate:ae,scrollToField:re,validateMessage:B,validateState:G});const ie=a((()=>z.direction||q.direction)),oe=a((()=>f(M.b(),M.m(ie.value),M.m("inlaid",z.inlaid),M.m(`align-${z.labelAlign||q.labelAlign}`),M.m(`valign-${z.labelValign||q.labelValign}`),M.m(`star-${z.starPosition||q.starPosition}`),z.rootClass))),de=a((()=>$(z.rootStyle))),ue=a((()=>$({width:"horizontal"===ie.value&&(z.labelWidth||q.labelWidth)})));return(e,a)=>{const t=T;return p(),h(t,{class:w(y(oe)),style:x(y(de)),id:y(se)},{default:b((()=>[e.$slots.label||!y(i)(e.label)?(p(),h(t,{key:0,class:w(y(M).e("label")),style:x(y(ue))},{default:b((()=>[y(Y)?(p(),h(t,{key:0,class:w(y(M).e("star"))},{default:b((()=>[S("*")])),_:1},8,["class"])):_("",!0),E(e.$slots,"label",{},(()=>[S(F(e.label),1)]),!0)])),_:3},8,["class","style"])):_("",!0),V(t,{class:w(y(M).e("content"))},{default:b((()=>[E(e.$slots,"default",{},void 0,!0),E(e.$slots,"validate",{state:G.value},void 0,!0),y(J)?(p(),h(t,{key:0,class:w(y(M).e("error"))},{default:b((()=>[S(F(B.value),1)])),_:1},8,["class"])):_("",!0)])),_:3},8,["class"])])),_:3},8,["class","style","id"])}}}),[["__scopeId","data-v-89167c82"]]);let Y;function ee(e){return q(e)?e():e}function ae(e,a,t){return M(t.len)?e===t.len||`${a}.len`:M(t.min)&&M(t.max)?!(e<t.min||e>t.max)||`${a}.range`:M(t.min)?!(e<t.min)||`${a}.min`:!M(t.max)||(!(e>t.max)||`${a}.max`)}const te={string:(e,a)=>!!z(e)&&ae(e.length,"string",a),number:(e,a)=>!!M(e)&&ae(e,"number",a),integer:(e,a)=>!!Number.isInteger(e)&&ae(e,"number",a),float:(e,a)=>!(!Number.isFinite(e)||e%1==0)&&ae(e,"number",a),boolean:e=>O(e),function:e=>q(e),regexp(e){if(!z(e))return e instanceof RegExp;try{return new RegExp(e),!0}catch{return!1}},array:(e,a)=>!!Array.isArray(e)&&ae(e.length,"number",a),object:e=>e&&"object"==typeof e&&!Array.isArray(e),enum(e,a){var t;return!!(null==(t=a.enum)?void 0:t.includes(e))||"enum"},date:e=>e instanceof Date,url:e=>z(e)&&(()=>{if(Y)return Y;const e="[a-fA-F\\d:]",a=a=>a&&a.includeBoundaries?`(?:(?<=\\s|^)(?=${e})|(?<=${e})(?=\\s|$))`:"",t="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",s="[a-fA-F\\d]{1,4}",l=`\n(?:\n(?:${s}:){7}(?:${s}|:)|                                    // 1:2:3:4:5:6:7::  1:2:3:4:5:6:7:8\n(?:${s}:){6}(?:${t}|:${s}|:)|                             // 1:2:3:4:5:6::    1:2:3:4:5:6::8   1:2:3:4:5:6::8  1:2:3:4:5:6::1.2.3.4\n(?:${s}:){5}(?::${t}|(?::${s}){1,2}|:)|                   // 1:2:3:4:5::      1:2:3:4:5::7:8   1:2:3:4:5::8    1:2:3:4:5::7:1.2.3.4\n(?:${s}:){4}(?:(?::${s}){0,1}:${t}|(?::${s}){1,3}|:)| // 1:2:3:4::        1:2:3:4::6:7:8   1:2:3:4::8      1:2:3:4::6:7:1.2.3.4\n(?:${s}:){3}(?:(?::${s}){0,2}:${t}|(?::${s}){1,4}|:)| // 1:2:3::          1:2:3::5:6:7:8   1:2:3::8        1:2:3::5:6:7:1.2.3.4\n(?:${s}:){2}(?:(?::${s}){0,3}:${t}|(?::${s}){1,5}|:)| // 1:2::            1:2::4:5:6:7:8   1:2::8          1:2::4:5:6:7:1.2.3.4\n(?:${s}:){1}(?:(?::${s}){0,4}:${t}|(?::${s}){1,6}|:)| // 1::              1::3:4:5:6:7:8   1::8            1::3:4:5:6:7:1.2.3.4\n(?::(?:(?::${s}){0,5}:${t}|(?::${s}){1,7}|:))             // ::2:3:4:5:6:7:8  ::2:3:4:5:6:7:8  ::8             ::1.2.3.4\n)(?:%[0-9a-zA-Z]{1,})?                                             // %eth0            %1\n`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim(),r=new RegExp(`(?:^${t}$)|(?:^${l}$)`),n=new RegExp(`^${t}$`),i=new RegExp(`^${l}$`),o=e=>e&&e.exact?r:new RegExp(`(?:${a(e)}${t}${a(e)})|(?:${a(e)}${l}${a(e)})`,"g");o.v4=e=>e&&e.exact?n:new RegExp(`${a(e)}${t}${a(e)}`,"g"),o.v6=e=>e&&e.exact?i:new RegExp(`${a(e)}${l}${a(e)}`,"g");const d=o.v4().source,u=o.v6().source;return Y=new RegExp(`(?:^(?:(?:(?:[a-z]+:)?//)|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|${d}|${u}|(?:(?:[a-z\\u00a1-\\uffff0-9][-_]*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*(?:\\.(?:[a-z\\u00a1-\\uffff]{2,})))(?::\\d{2,5})?(?:[/?#][^\\s"]*)?$)`,"i"),Y})().test(e),hex:e=>z(e)&&/^#(?:[0-9A-F]{6}|[0-9A-F]{3})$/i.test(e),email:e=>z(e)&&/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(e)};class se{constructor(){this.validateMessages=void 0}setValidateMessages(e){this.validateMessages=e}getValidTriggerRules(e,a){let t=e;if(a){const l=s(a);t=e.filter(Boolean).filter((e=>{let{trigger:a}=e;return!a||(a=s(a),l.some((e=>a.includes(e))))}))}return t}validate(e,a={}){const{validateFirst:t,value:s}=a;return new Promise(((l,r)=>{t?Promise.all(e.map((e=>this.validateRule(s,e)))).then((()=>{l()})).catch((({error:e,rule:t})=>{r([this.replaceSymbol(e,t,a)])})):Promise.allSettled(e.map((e=>this.validateRule(s,e)))).then((e=>{const t=e.filter((({status:e})=>"rejected"===e));0===t.length?l():r(t.map((e=>{const{error:t,rule:s}=e.reason;return this.replaceSymbol(t,s,a)})))}))}))}validateRule(e,a){return a.transform&&(e=a.transform(e)),new Promise(((s,l)=>{const r=e=>{l({error:e,rule:a})};if(j(e,a.whitespace)&&!a.validator)return void(a.required?r(ee(a.message)||t(this.validateMessages,"required")):s());if(a.validator){const t=a.validator(e,a);return void(t instanceof Promise?t.then((()=>{s()})).catch((e=>{r(e)})):!0===t?s():z(t)?r(t):r(ee(a.message)))}if(a.pattern instanceof RegExp){return void(a.pattern.test(String(e))?s():r(ee(a.message)||t(this.validateMessages,"pattern.mismatch")))}let n=a.type;!n&&(M(a.min)||M(a.max)||M(a.len))&&(n="string"),n&&Object.keys(te).includes(n)?this.validateInternal(n,e,a).then((()=>{s()})).catch((e=>{r(ee(a.message)||e)})):s()}))}validateInternal(e,a,s){return new Promise(((l,r)=>{var n;const i=null==(n=te[e])?void 0:n.call(te,a,s);!0===i?l():r(t(this.validateMessages,z(i)?i:`types.${e}`))}))}replaceSymbol(e,a,t={}){var s;e instanceof Error&&(e=e.message),z(e)||(e=String(e));const l=z(t.label)?t.label:String(t.name),r={"${min}":a.min,"${max}":a.max,"${len}":a.len,"${enum}":a.enum,"${label}":l,"${value}":t.value,"${type}":a.type,"${pattern}":null==(s=a.pattern)?void 0:s.toString()};return e.replace(/\$\{(?:min|max|len|enum|label|value|type|pattern)\}/g,(e=>r[e]??""))}}const le=U(e({options:{virtualHost:!0,styleIsolation:"shared"},__name:"form",props:G,setup(e,{expose:t}){const l=e,r=W("form"),i=e=>{let a=m;return e&&e.length>0&&(a=m.filter((a=>e.findIndex((e=>B(s(a.name),s(e))))>-1))),a},o=async e=>{const a=(await Promise.allSettled(i(e).map((e=>e.validate())))).filter((e=>"rejected"===e.status));if(a.length>0){const e=a.map((e=>e.reason));throw l.scrollToFirstError&&c(e[0].name),e}},c=e=>{var a;null==(a=(e=>m.find((a=>B(s(a.name),s(e)))))(e))||a.scrollToField()};t({validate:o,reset:async e=>{await Promise.allSettled(i(e).map((e=>{e.reset()})))},clearValidate:async e=>{await Promise.allSettled(i(e).map((e=>{e.clearValidate()})))},scrollToField:c});const m=[],g=k(new se),{select:S}=C("form.defaultValidateMessages");g.setValidateMessages(S()),n((()=>l.rules),(()=>{l.validateOnRuleChange&&o().catch(P)}),{deep:!0}),v(Q,d({model:u(l,"model"),rules:u(l,"rules"),validateTrigger:u(l,"validateTrigger"),direction:u(l,"direction"),labelWidth:u(l,"labelWidth"),labelAlign:u(l,"labelAlign"),labelValign:u(l,"labelValign"),starPosition:u(l,"starPosition"),showError:u(l,"showError"),scrollIntoViewOptions:u(l,"scrollIntoViewOptions"),disabled:u(l,"disabled"),readonly:u(l,"readonly"),addField:e=>{m.push(e)},removeField:e=>{m.splice(m.indexOf(e),1)},validator:g}));const _=a((()=>f(r.b(),l.rootClass))),F=a((()=>$(l.rootStyle)));return(e,a)=>{const t=T;return p(),h(t,{class:w(y(_)),style:x(y(F))},{default:b((()=>[E(e.$slots,"default",{},void 0,!0)])),_:3},8,["class","style"])}}}),[["__scopeId","data-v-6f2d44c2"]]);export{X as _,le as a};
